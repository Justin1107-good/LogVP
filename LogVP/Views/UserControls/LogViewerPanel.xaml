<UserControl
    x:Class="LogVP.Views.UserControls.LogViewerPanel"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:LogVP.Views.UserControls"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    d:DesignHeight="450"
    d:DesignWidth="800"
    mc:Ignorable="d">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!--  工具栏  -->
        <ToolBar Grid.Row="0" Height="30">
            <Button
                Name="btnClear"
                Margin="2"
                Click="BtnClear_Click"
                Content="清空" />
            <Button
                Name="btnExport"
                Margin="2"
                Click="BtnExport_Click"
                Content="导出" />
            <Button
                Name="btnLoadFolder"
                Margin="2"
                Click="BtnLoadFolder_Click"
                Content="加载文件夹" />
            <Button
                Name="btnLoadFile"
                Margin="2"
                Click="BtnLoadFile_Click"
                Content="加载文件" />
            <Separator />
            <CheckBox
                Name="chkAutoScroll"
                Margin="2"
                Content="自动滚动"
                IsChecked="True" />
            <CheckBox
                Name="chkPause"
                Margin="2"
                Click="ChkPause_Click"
                Content="暂停"
                IsChecked="False" />
            <Separator />
            <TextBlock
                Margin="5,0"
                VerticalAlignment="Center"
                Text="级别:" />
            <ComboBox
                Name="cmbLogLevel"
                Width="100"
                Margin="2"
                SelectionChanged="CmbLogLevel_SelectionChanged">
                <ComboBoxItem Content="全部" Tag="All" />
                <ComboBoxItem Content="调试(Debug)" Tag="Debug" />
                <ComboBoxItem Content="信息(Info)" Tag="Info" />
                <ComboBoxItem Content="警告(Warn)" Tag="Warn" />
                <ComboBoxItem Content="错误(Error)" Tag="Error" />
                <ComboBoxItem Content="致命(Fatal)" Tag="Fatal" />
            </ComboBox>
            <Separator />
            <TextBlock
                Margin="5,0"
                VerticalAlignment="Center"
                Text="最大条数:" />
            <ComboBox
                Name="cmbMaxLogs"
                Width="80"
                Margin="2"
                SelectionChanged="CmbMaxLogs_SelectionChanged">
                <ComboBoxItem Content="1000" Tag="1000" />
                <ComboBoxItem
                    Content="5000"
                    IsSelected="True"
                    Tag="5000" />
                <ComboBoxItem Content="10000" Tag="10000" />
                <ComboBoxItem Content="无限制" Tag="0" />
            </ComboBox>
            <Separator />
            <TextBox
                Name="txtSearch"
                Width="150"
                Margin="2"
                TextChanged="TxtSearch_TextChanged"
                ToolTip="搜索日志内容" />
            <Button
                Name="btnSearch"
                Margin="2"
                Click="BtnSearch_Click"
                Content="搜索" />
        </ToolBar>

        <!--  日志显示区域  -->
        <DataGrid
            Name="dgLogs"
            Grid.Row="1"
            AlternatingRowBackground="LightGray"
            AutoGenerateColumns="False"
            GridLinesVisibility="None"
            HeadersVisibility="Column"
            IsReadOnly="True"
            MinRowHeight="25"
            MouseDoubleClick="DgLogs_MouseDoubleClick"
            SelectionMode="Extended"
            SelectionUnit="FullRow"
            VirtualizingStackPanel.IsVirtualizing="True"
            VirtualizingStackPanel.VirtualizationMode="Recycling">
            <DataGrid.Columns>
                <DataGridTextColumn
                    Width="120"
                    Binding="{Binding Time, StringFormat='HH:mm:ss.fff'}"
                    Header="时间" />
                <DataGridTextColumn
                    Width="80"
                    Binding="{Binding Level}"
                    Header="级别" />
                <DataGridTextColumn
                    Width="*"
                    Binding="{Binding Message}"
                    Header="消息" />
                <DataGridTextColumn
                    Width="120"
                    Binding="{Binding Source}"
                    Header="来源" />
                <DataGridTextColumn
                    Width="150"
                    Binding="{Binding FileName}"
                    Header="文件" />
            </DataGrid.Columns>
            <DataGrid.RowStyle>
                <Style TargetType="DataGridRow">
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding Level}" Value="Error">
                            <Setter Property="Background" Value="Yellow" />
                        </DataTrigger>
                        <DataTrigger Binding="{Binding Level}" Value="Fatal">
                            <Setter Property="Background" Value="Red" />
                        </DataTrigger>
                        <DataTrigger Binding="{Binding Level}" Value="Warn">
                            <Setter Property="Background" Value="#FFFFE5" />
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </DataGrid.RowStyle>
        </DataGrid>

        <!--  状态栏  -->
        <StatusBar Grid.Row="2">
            <StatusBarItem>
                <TextBlock Name="txtStatus" Text="就绪" />
            </StatusBarItem>
            <StatusBarItem>
                <ProgressBar
                    Name="progressBar"
                    Width="100"
                    Height="16"
                    Visibility="Collapsed" />
            </StatusBarItem>
            <StatusBarItem HorizontalAlignment="Center" VerticalAlignment="Center">
                <TextBlock
                    Name="Copyright"
                    FontWeight="Black"
                    Text="@Copyright 2020-2025" />
            </StatusBarItem>
            <StatusBarItem HorizontalAlignment="Right">
                <TextBlock Name="txtLogCount" Text="日志条数: 0" />
            </StatusBarItem>
        </StatusBar>
    </Grid>
</UserControl>
